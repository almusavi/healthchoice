<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <title>Google Maps Multiple Markers</title>
  <script src="https://maps.google.com/maps/api/js?key=AIzaSyAaT_k8ZavcjlWgoadxwXK2QzRVEvoGFzw"
          type="text/javascript"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/jscroll/2.3.7/jquery.jscroll.js"></script>
</head>

<div class="map-position1">
<div id="map" style="width: 100%; height: 250px;"></div>

<div class="indexpage">

<div>
	<p class="searchresults">SEARCH RESULTS FOR: <%= @search %></p>
	<% @providers.each do |provider| %>
		<div class="card-block eachprovider cardsize">
			<div class="avatar">
				<img src="/images/avatar.jpg">
			</div>
			<div>
			<span class = "name">
				<a  href="/providers/<%= provider.id %>"><%= provider.firstname + " " + provider.lastname %></a><br>
				</span>
				<i class="title"><%= provider.title %></i>
				<p><%= provider.accountname %></p>
				<span class="fa fa-map-marker"><%= provider.distance %></span>
				<span class="citystate"> | <%= provider.mailingcity + ", " + provider.mailingstate %></span>
				<br>
				<br>
				<form action="mailto:<%= provider.email %>" method="post" enctype="text/plain">
				<input type="image" src="/images/emailicon.png" border="0" alt="Submit">

				<form action="mailto:<%= provider.email %>" method="post" enctype="text/plain">
				<input type="image" src="/images/phone-outline.png" border="0" alt="Submit">
				<% @locations << [provider.accountname.strip, provider.maillatitude, provider.maillongitude] %>

			</div>
		</div>
		<br>
	<% end %>
	<span class = "will_paginate"> <%= will_paginate @providers %> </span>
	<br>
</div>
<div>


  <script type="text/javascript">
var locations = <%=raw @locations %>
    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 12,
      styles: [
    {
        "featureType": "administrative",
        "elementType": "all",
        "stylers": [
            {
                "visibility": "on"
            },
            {
                "lightness": 33
            }
        ]
    },
    {
        "featureType": "landscape",
        "elementType": "all",
        "stylers": [
            {
                "color": "#f2e5d4"
            }
        ]
    },
    {
        "featureType": "poi.park",
        "elementType": "geometry",
        "stylers": [
            {
                "color": "#c5dac6"
            }
        ]
    },
    {
        "featureType": "poi.park",
        "elementType": "labels",
        "stylers": [
            {
                "visibility": "on"
            },
            {
                "lightness": 20
            }
        ]
    },
    {
        "featureType": "road",
        "elementType": "all",
        "stylers": [
            {
                "lightness": 20
            }
        ]
    },
    {
        "featureType": "road.highway",
        "elementType": "geometry",
        "stylers": [
            {
                "color": "#c5c6c6"
            }
        ]
    },
    {
        "featureType": "road.arterial",
        "elementType": "geometry",
        "stylers": [
            {
                "color": "#e4d7c6"
            }
        ]
    },
    {
        "featureType": "road.local",
        "elementType": "geometry",
        "stylers": [
            {
                "color": "#fbfaf7"
            }
        ]
    },
    {
        "featureType": "water",
        "elementType": "all",
        "stylers": [
            {
                "visibility": "on"
            },
            {
                "color": "#acbcc9"
            }
        ]
    }
],

      center: new google.maps.LatLng(<%= latlon(@search)["lat"] %>, <%= latlon(@search)["lng"] %>),
      mapTypeId: google.maps.MapTypeId.ROADMAP
    });
    var infowindow = new google.maps.InfoWindow();
    var marker, i;
    for (i = 0; i < locations.length; i++) {
      marker = new google.maps.Marker({
        position: new google.maps.LatLng(locations[i][1], locations[i][2]),
        map: map
      });
      google.maps.event.addListener(marker, 'click', (function(marker, i) {
        return function() {
          infowindow.setContent(locations[i][0]);
          infowindow.open(map, marker);
        }
      })(marker, i));
    }
  </script>


</div>
</div>
</div>