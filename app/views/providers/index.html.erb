<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <title>Google Maps Multiple Markers</title>
  <script src="https://maps.google.com/maps/api/js?key=AIzaSyAaT_k8ZavcjlWgoadxwXK2QzRVEvoGFzw"
          type="text/javascript"></script>
</head>

<div class="indexpage">
<div>
	<p class="searchresults">SEARCH RESULTS FOR: <%= @search %></p>
	<% @providers.each do |provider| %>
		<div class="card-block eachprovider cardsize">
			<div class="avatar">
				<img src="/images/avatar.jpg">
			</div>
			<div>
			<span class = "name">
				<a  href="/providers/<%= provider.id %>"><%= provider.firstname + " " + provider.lastname %></a><br>
				</span>
				<i class="title"><%= provider.title %></i>
				<p><%= provider.accountname %></p>
				<span class="fa fa-map-marker"><%= provider.distance %></span>
				<span class="citystate"> | <%= provider.mailingcity + ", " + provider.mailingstate %></span>
				<br>
				<br>
				<form action="mailto:<%= provider.email %>" method="post" enctype="text/plain">
				<input type="image" src="/images/emailicon.png" border="0" alt="Submit">

				<form action="mailto:<%= provider.email %>" method="post" enctype="text/plain">
				<input type="image" src="/images/phone-outline.png" border="0" alt="Submit">
				<% @locations << [provider.accountname.strip, provider.maillatitude, provider.maillongitude] %>

			</div>
		</div>
		<br>
	<% end %>
	<span class = "will_paginate"> <%= will_paginate @providers %> </span>
	<br>
</div>
<div>

<div class="map-position">
<div id="map" style="width: 500px; height: 400px;"></div>
  <script type="text/javascript">




var locations = <%=raw @locations %>
    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 10,
      center: new google.maps.LatLng(<%= latlon(@search)["lat"] %>, <%= latlon(@search)["lng"] %>),
      mapTypeId: google.maps.MapTypeId.ROADMAP
    });
    var infowindow = new google.maps.InfoWindow();
    var marker, i;
    for (i = 0; i < locations.length; i++) {
      marker = new google.maps.Marker({
        position: new google.maps.LatLng(locations[i][1], locations[i][2]),
        map: map
      });
      google.maps.event.addListener(marker, 'click', (function(marker, i) {
        return function() {
          infowindow.setContent(locations[i][0]);
          infowindow.open(map, marker);
        }
      })(marker, i));
    }
  </script>


</div>
</div>
</div>